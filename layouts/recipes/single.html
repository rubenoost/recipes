{{ define "main" }}
<article class="recipe container">
  <header class="recipe-header">
    <h1>{{ .Title }}</h1>
    {{ with .Description }}<p class="recipe-description">{{ . }}</p>{{ end }}

    <div class="recipe-meta-bar">
      {{ with .Params.prep_time }}<span class="meta-item">Voorbereiding: {{ . }}</span>{{ end }}
      {{ with .Params.cook_time }}<span class="meta-item">Bereiden: {{ . }}</span>{{ end }}
      {{ with .Params.servings }}<span class="meta-item">Porties: {{ . }}</span>{{ end }}
    </div>
  </header>

  {{ with .Params.image }}
  <img src="{{ . }}" alt="{{ $.Title }}" class="recipe-hero-image">
  {{ end }}

  <div class="recipe-body">
    <section class="ingredients">
      <h2>Ingrediënten</h2>
      {{ if (index .Params.ingredients 0).group }}
        {{/* Gegroepeerde ingrediënten */}}
        {{ range .Params.ingredients }}
        <h3>{{ .group }}</h3>
        <ul>
          {{ range .items }}
          <li><strong>{{ .amount }}</strong> {{ .item }}</li>
          {{ end }}
        </ul>
        {{ end }}
      {{ else }}
        {{/* Platte lijst */}}
        <ul>
          {{ range .Params.ingredients }}
          <li><strong>{{ .amount }}</strong> {{ .item }}</li>
          {{ end }}
        </ul>
      {{ end }}
    </section>

    <section class="instructions">
      <h2>Bereiding</h2>
      <ol>
        {{ range .Params.instructions }}
        <li>{{ .step }}</li>
        {{ end }}
      </ol>
    </section>

    {{ with .Content }}
    <section class="recipe-notes">
      <h2>Notities</h2>
      {{ . }}
    </section>
    {{ end }}
  </div>

  {{ with .Params.tags }}
  <footer class="recipe-tags">
    <strong>Tags:</strong>
    {{ range . }}
    <a href="{{ "tags/" | relURL }}{{ . | urlize }}/" class="tag">{{ . }}</a>
    {{ end }}
  </footer>
  {{ end }}

  {{ with .Params.source }}
  <p class="recipe-source"><strong>Bron:</strong> <a href="{{ . }}" target="_blank" rel="noopener">{{ . }}</a></p>
  {{ end }}
</article>

{{- $ingredients := slice }}
{{- if (index .Params.ingredients 0).group }}
  {{- range .Params.ingredients }}
    {{- range .items }}
      {{- $ingredients = $ingredients | append (printf "%s %s" .amount .item) }}
    {{- end }}
  {{- end }}
{{- else }}
  {{- range .Params.ingredients }}
    {{- $ingredients = $ingredients | append (printf "%s %s" .amount .item) }}
  {{- end }}
{{- end }}
{{- $instructions := slice }}
{{- range .Params.instructions }}
  {{- $instructions = $instructions | append (dict "text" .step) }}
{{- end }}
{{- $schema := dict
  "@context" "https://schema.org/"
  "@type" "Recipe"
  "name" .Title
  "description" .Description
  "author" (dict "@type" "Organization" "name" site.Title)
  "datePublished" (.Date.Format "2006-01-02")
  "recipeIngredient" $ingredients
  "recipeInstructions" $instructions
}}
{{- with .Params.image }}{{ $schema = merge $schema (dict "image" (. | absURL)) }}{{ end }}
{{- with .Params.servings }}{{ $schema = merge $schema (dict "recipeYield" (printf "%d porties" .)) }}{{ end }}
{{- with .Params.prep_time }}{{ $schema = merge $schema (dict "prepTime" (printf "PT%s" (replace (replace . " minuten" "M") " uur" "H"))) }}{{ end }}
{{- with .Params.cook_time }}{{ $schema = merge $schema (dict "cookTime" (printf "PT%s" (replace (replace . " minuten" "M") " uur" "H"))) }}{{ end }}
<script type="application/ld+json">
{{ $schema | jsonify (dict "indent" "  ") | safeJS }}
</script>
{{ end }}
